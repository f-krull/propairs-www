<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link rel="shortcut icon" href="css/propairs_logo_fav.ico">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<script type="text/javascript" src="js/vue-3.1.5.js"></script>
<script type="text/javascript" src="js/bootstrap.bundle.min.js"></script>
<link rel="stylesheet" href="css/bootstrap.min.css" type="text/css"/>
<link rel="stylesheet" href="css/tabulator.min.css" type="text/css"/>

<script type="text/javascript" src="js/pp_helper.js"></script>
<script type="text/javascript" src="js/pp_layout.js"></script>
<style>

  :root {
    --color-u1: #c9d4fd;
    --color-u2: #BBFFBB;
    --color-u1d: #bdc8f3;
    --color-u2d: rgb(172, 240, 172);
    --color-u1dd: #a6b0d8;
    --color-u2dd: rgb(146, 206, 146);
  }


  
/*------------------*/

#dbDetailData span.emph {
   display: block;
   float: left;
   width: 100px;
   min-height: 18px;
   font-weight: bold;
}
#dbDetailData span.pdb {
   width: 50px;
   font-weight: bold;
   color: #000;
   font-size: 13px;
   line-height: 30px;
}
#dbDetailData .aln {
   text-align: center;
   width: 540px;
   margin: 10px;
}
#dbDetailData .aln > button {
   width: 200px;
}
#dbDetailData .alnData {
   text-align: left;
   overflow: auto;
   padding: 5px;
}
#dbDetailData .alnData > span {
   font-family: "Courier",monospace;
   white-space: pre;
   font-size: 14px;
   line-height: 18px;
}

/*------------------*/

#dbDetailData table {
   table-layout: fixed;
   overflow: hidden;
   border-spacing: 0;
   border-collapse: unset;
}
#dbDetailData .border {
   width: 10px;
}
#dbDetailData .space {
   width: 30px;
}
#dbDetailData .content {
   width: 240px;
}
#dbDetailData tr.spaceb td {
   padding-bottom: 10px;
}
#dbDetailData tr.spaceh td {
   padding-top: 10px;
}
/*-- middle --*/
#dbDetailData table td:nth-child(4) {
   text-align: center;
   color: #000;
   font-size: 14pt;
}
/*-- content --*/
#dbDetailData td:nth-child(2), #dbDetailData td:nth-child(6),
#dbDetailData th:nth-child(2), #dbDetailData th:nth-child(6){
   border-left: 2px solid gray;
   border-right: 2px solid gray;
   text-indent: 5px;
   line-height: 18px;
}
#dbDetailData th {
   font-size: 14px;
   line-height: 24px;
   text-indent: 10px;
   color: #FFF;
   border: solid 2px;
   text-align: left;
}
#dbDetailData tr.last td:nth-child(2), #dbDetailData tr.last td:nth-child(6) {
   border-bottom: 2px solid gray;
}
/*-- b1 --*/
#dbDetailData tr.x1 th:nth-child(2) {
   background-color: #A183CE;
   border: solid 2px #A183CE;
}
#dbDetailData tr.x1 td:nth-child(2) {
   background-color: #DCC7FC;
   border-color: #A183CE;
}
/*-- u1 --*/
#dbDetailData tr.x1 th:nth-child(6) {
   background-color: #2A41A0;
   border: solid 2px #2A41A0;
}
#dbDetailData tr.x1 td:nth-child(6) {
   background-color: #C7D2FF;
   border-color: #2A41A0;
}
/*-- b2 --*/
#dbDetailData tr.x2 th:nth-child(2) {
   background-color: #78AD5C;
   border: solid 2px #78AD5C;
}
#dbDetailData tr.x2 td:nth-child(2) {
   background-color: #D3FFBB;
   border-color: #78AD5C;
}
/*-- u2 --*/
#dbDetailData tr.x2 th:nth-child(6) {
   background-color: #2F813C;
   border: solid 2px #2F813C;
}
#dbDetailData tr.x2 td:nth-child(6) {
   background-color: #BBFFBB;
   border-color: #2F813C;
}
/*-- bc --*/
#dbDetailData tr.bc td:nth-child(2) {
   border: 2px solid #CCC;
   background-color: #CCC;
}
#dbDetailData tr.bc td:nth-child(6) {
   border: 0px solid #FFF;
}
/*-- b gray --*/
/* col */
#dbDetailData tr td:nth-child(1) {
   border: 2px solid #CCC;
   background-color: #CCC;
}
#dbDetailData tr td:nth-child(3) {
   border: 2px solid #CCC;
   background-color: #CCC;
}
/* row */
#dbDetailData tr:first-child td {
   border: 0px solid #FFF;
   padding: 5px;
}
#dbDetailData tr:last-child td {
   border: 0px solid #FFF;
   padding: 5px;
}
#dbDetailData tr:first-child td:nth-child(2) {
   border: 2px solid #CCC;
   background-color: #CCC;
}
#dbDetailData tr:last-child td:nth-child(2) {
   border: 2px solid #CCC;
   background-color: #CCC;
}
/* corners */
#dbDetailData tr:first-child td:nth-child(1) {
   border-radius: 5px 0px 0px 0px;
}
#dbDetailData tr:first-child td:nth-child(3) {
   border-radius: 0px 5px 0px 0px;
}
#dbDetailData tr:last-child td:nth-child(1) {
   border-radius: 0px 0px 0px 5px;
}
#dbDetailData tr:last-child td:nth-child(3) {
   border-radius: 0px 0px 5px 0px;
}




</style>
</head>
<body>
  <script>pplayout.init();</script>
  <header id="pp-nav" class="mb-auto"></header><script>pplayout.nav();</script>
  <div class="container">
    <div id="app" class="my-4">
      <h1>&#x1F6A7; under construction &#x1F6A7; </h1>
      <p v-if="loading">loading...</p>
      <div v-else>
        <span id="headline" class="h2 py-lg-3">Detail view {{cplx.bp}} {{cplx.b1ci}} {{cplx.b2ci}}</span><br>
        <span id="subheadline" class="py-lg-3">({{seedIdx}}/{{datasetId}})</span>
        <cplx-detail-data v-bind:cplx="cplx">
      </div>
      </cplx-detail-data>
      <cplx-cluster v-if="!loading" v-bind:cplx="cplx" v-bind:dataset-id="datasetId"></cplx-cluster>
    </div>
  </div>
  <script>
    
    const app = Vue.createApp({
      data() {
        return {
          loading: true,
          cplx: null,
          datasetId: null,
          seedIdx: null,
        }
      },
      async created() {
        const _getPdbInfo = (n) => {
          const inf = {
            pdb4: "-",
            exp: null,
          }
          if (n.length > 2) {
            inf.exp = n.charAt(4).match(/[0-9]/)
              ? `biol.unit ${n.charAt(4)}`
              : `Model ${"a".charCodeAt(0)-n.charCodeAt(4)+1}`;
            inf.pdb4 = n.substr(0,4)
          };
          return inf
          //return `<b><a href="https://www.rcsb.org/structure/${n.substr(0,4)}">${n.substr(0,4)}</a></b> ${t}`;
        }
    
        const _getRmsd = (r) => {
          return `${r} Ã…`;
        }
        const urlParams = new URLSearchParams(window.location.search);
        const set_id = urlParams.get("set");
        const seed_idx = urlParams.get("id");
        
        const cjsn = await (async function(){
          const data_url = `./data/${set_id}/info/${seed_idx}/complex.json`;
          const r = await fetch(data_url, {
            method: "GET"
          });
          return await r.json();
        })();
        {
          const { pdb4, exp } = _getPdbInfo(cjsn.bp)
          cjsn.bname = pdb4
          cjsn.bexp = exp
        }
        {
          const { pdb4, exp } = _getPdbInfo(cjsn.u1p)
          cjsn.u1name = pdb4
          cjsn.u1exp = exp
        }
        {
          const { pdb4, exp } = _getPdbInfo(cjsn.u2p)
          cjsn.u2name = pdb4
          cjsn.u2exp = exp
        }
        cjsn.u1irmsd = _getRmsd(cjsn.u1irmsd);
        cjsn.u2irmsd = _getRmsd(cjsn.u2irmsd);
        cjsn.u1sim =  parseFloat(cjsn.u1sim);
        cjsn.u2sim =  parseFloat(cjsn.u2sim);
        cjsn.hasu2 = !!parseInt(cjsn.hasu2);
        console.log(cjsn);
        this.cplx = cjsn;
        this.datasetId = set_id;
        this.seedIdx = seed_idx;
        this.loading = false;
      }, 
    })
    app.component('cplx-detail-data', {
      props: ['cplx'],
      created() {
        console.log(this.cplx);
      },
      template: /*html*/`
      <div id="dbDetailData"> 
        <cplx-detail-align v-bind:cplx="cplx"></cplx-detail-align>
        <table>
        <colgroup>
          <col span="1" class="border">
          <col span="1" class="content">
          <col span="1" class="border">
          <col span="1" class="space">
          <col span="1" class="border">
          <col span="1" class="content">
          <col span="1" class="border">
        </colgroup>
        <tbody>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr class="x1"><td></td><th>Bound 1</th><td></td><td></td><td></td><th>Unbound 1</th><td></td></tr>
        <tr class="x1"><td></td><td></td><td></td><td></td><td></td><td><cplx-detail-pdb-url :pdb4="cplx.u1name" :exp="cplx.u1exp"></cplx-detail-pdb-url></td><td></td></tr>
        <tr class="x1 spaceb"><td></td><td></td><td></td><td></td><td></td><td>{{cplx.u1type}}</td><td></td></tr>
        <tr class="x1 spaceb"><td></td><td><span class="emph">Chains:</span><span>{{cplx.b1c}}</span></td><td></td><td></td><td></td><td><span class="emph">Chains:</span><span>{{cplx.u1c}}</span></td><td></td></tr>
        <tr  class="x1"><td></td>     <td  title="chains participating in the interface"><span class="emph">Int. Chains:</span><span>{{cplx.b1ci}}</span></td><td></td><td>&rarr;</td><td></td><td title="chains participating in the interface"><span class="emph">Int. Chains:</span><span>{{cplx.u1ci}}</span></td><td></td></tr>
        <tr class="x1"><td></td>      <td title="number of C&alpha; atoms in the interface"><span class="emph">Int. C&alpha;:</span><span>{{cplx.b1ca}}</span></td><td></td><td></td><td></td><td title="RMSD to the interface of the bound structure"><span class="emph">Int. RMSD:</span><span>{{cplx.u1irmsd}}</span></td><td></td></tr>
        <tr class="x1 cof"><td></td>  <td title="number of gaps in the interface"><span class="emph">Int. Gaps:</span><span>{{cplx.b1gaps}}</span></td><td></td><td></td><td></td><td title="number of gaps in the interface"><span class="emph">Int. Gaps:</span><span>{{cplx.u1gaps}}</span></td><td></td></tr>
        <tr class="x1 last spaceb"><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>

        <tr class="bc spaceh"><td></td><td><cplx-detail-pdb-url :pdb4="cplx.bname" :exp="cplx.bexp"></cplx-detail-pdb-url></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr class="bc spaceb"       ><td></td><td id="val-btype">{{cplx.btype}}</td><td></td><td></td><td></td><td></td><td></td></tr>
        <!-- <tr class="bc spaceb"><td></td><td title="show interface cluster"><button id="clus" value="{{cluster}}"">Show sim. interfaces</button></td><td></td><td></td><td></td><td></td><td></td></tr> -->
        <tr class="x2"><td></td><th>Bound 2</th><td></td><td></td><td></td><th>Unbound 2</th><td></td></tr>
        <tr class="x2"><td></td><td></td><td></td><td></td><td></td><td><cplx-detail-pdb-url :pdb4="cplx.u2name" :exp="cplx.u2exp"></cplx-detail-pdb-url></td><td></td></tr>
        <tr class="x2 spaceb"><td></td><td></td><td></td><td></td><td></td><td id="val-u2type">{{cplx.u2type}}</td><td></td></tr>
        <tr class="x2 spaceb"><td></td><td><span class="emph">Chains:</span><span id="val-b2c">{{cplx.b2c}}</span></td><td></td><td></td><td></td><td ><span class="emph">Chains:</span><span id="val-u2c">{{cplx.u2c}}</span></td><td></td></tr>
        <tr class="x2"><td></td><td  title="chains participating in the interface"><span class="emph">Int. Chains:</span><span id="val-b2ci">{{cplx.b2ci}}</span></td><td></td><td>&rarr;</td><td></td><td title="chains participating in the interface"><span class="emph">Int. Chains:</span><span id="val-u2ci">{{cplx.u2ci}}</span></td><td></td></tr>
        <tr class="x2"><td></td><td  title="number of C&alpha; atoms in the interface"><span class="emph">Int. C&alpha;:</span><span id="val-b2ca">{{cplx.b2ca}}</span></td><td></td><td></td><td></td><td title="RMSD to the interface of the bound structure"><span class="emph">Int. RMSD:</span><span id="val-u2irmsd">{{cplx.u2irmsd}}</span></td><td></td></tr>
        <tr class="x2 cof"><td></td><td  title="number of gaps in the interface"><span class="emph">Int. Gaps:</span><span id="val-b2gaps">{{cplx.b2gaps}}</span></td><td></td><td></td><td></td><td title="number of gaps in the interface"><span class="emph">Int. Gaps:</span><span id="val-u2gaps">{{cplx.u2gaps}}</span></td><td></td></tr>
        <tr class="x2 last spaceb"><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        </tbody>
        </table>
        <cplx-detail-align v-bind:cplx="cplx"></cplx-detail-align>
      </div>
        `,
     });
    app.component('cplx-detail-align', {
      props: ['cplx'],
      template: /*html*/`
        <div class="aln" data-id="aln1">
          <button title="show interface alignments">
            Show interface alignment (similarity={{cplx.u1sim*100}}%)
          </button>
          <div class="alnData"></div>
        </div>
      `
    });
    app.component('cplx-cluster', {
      props: ['datasetId', 'cplx',],
      created() {
        console.log(this.datasetId)
      },
      template: /*html*/`
      <div>
        <a v-bind:href='getUrlSimU1()'                  >Show all similar unbound structures for {{ cplx.u1name }} {{ cplx.u1ci }} (binding partner 1)</a><br>
        <a v-bind:href='getUrlSimU2()' v-if='cplx.hasu2'>Show all similar unbound structures for {{ cplx.u2name }} {{ cplx.u2ci }} (binding partner 2)</a><br>
        <a v-bind:href='getUrlCluster()'>Show all similar interfaces for {{ cplx.bname }} {{cplx.b1ci}}:{{cplx.b2ci}}</a><br>
        </div>
        `,
        methods: {
          getUrlSimU1() {
            return `comprehensive.html?set=${this.datasetId}&filterSEEDPB=${this.cplx.bname}&filterCBI1=${this.cplx.b1ci}&filterCBI2=${this.cplx.b2ci}`
          },
          getUrlSimU2() {
            return `comprehensive.html?set=${this.datasetId}&filterSEEDPB=${this.cplx.bname}&filterCBI1=${this.cplx.b2ci}&filterCBI2=${this.cplx.b1ci}`
          },
          getUrlCluster() {
            return `comprehensive.html?set=${this.datasetId}&filterCLUSID=${this.cplx.cluster}`
          },
        }
    });
    app.component('cplx-detail-pdb-url', {
      props: ['pdb4','exp'],
      template: /*html*/`
      <a :href="'https://www.rcsb.org/structure/'+pdb4">{{pdb4}}</a> <span v-if="exp"> ({{ exp }})</span>
      `
    });
    app.mount('#app');
  </script>
  <footer id="pp-footer"></footer><script>pplayout.footer();</script>
</body>
</html>

